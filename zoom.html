
<!DOCTYPE html>
<html>
    <head>
        <title>ZOOM URL Generator</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <script>
            (function() {
                const vars = {}
                const parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
                    vars[key] = value
                })
                if (vars.jump) {
                    const device = localStorage.getItem("device")
                    if (!device) localStorage.setItem("device", confirm("using mobile zoom?"))
                    const prefix = localStorage.getItem("device") == "true" ? "zoomus" : "zoommtg"
                    const result = `${prefix}://zoom.us/join?confno=${encodeURIComponent(decodeURIComponent(vars.confno))}&pwd=${encodeURIComponent(decodeURIComponent(vars.pwd))}&uname=${encodeURIComponent(decodeURIComponent(vars.uname))}`
                    console.log(result)
                    var a = document.createElement("a")
                    var p = document.createElement("p")
                    p.innerText = `Conf ID: ${vars.confno}, Redirect Mode: ${device ? 'Mobile' : 'PC'}`
                    a.innerText = "If nothing happens, click me to review settings."
                    a.setAttribute("href", "https://ichoake.github.io/zoom-url-generator/")
                    document.write(p.outerHTML)
                    document.write(a.outerHTML)
                    window.location.replace(result)
                }
            })()
        </script>
        <style></style>
        <link href="styles/main.css" rel="stylesheet">
       
    </head>
    <body>
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-6">
                    <h1>Generate Zoom URL</h1>
                    <div class="form-group">
                        <label for="meeting-id">Meeting ID</label>
                        <input class="form-control" id="meeting-id">
                        <small class="form-text text-muted">"956 4485 9450" is cgs1821 room. Test the URL with this meeting id.</small>
                        <small class="form-text text-muted">This field accept all formats including "956-448-5450", "956 4485 9450" or "95644859450". All non-digit characters get deleted.</small>
                    </div>
                    <div class="form-group">
                        <label for="meeting-password">Password</label>
                        <input class="form-control" id="meeting-password">
                    </div>
                    <div class="form-group">
                        <label for="meeting-name">Name when Joining</label>
                        <input class="form-control" id="meeting-name">
                        <small class="form-text text-muted">This is your name after joining the Room. This way you don't have to rename every time you enter the Room.</small>
                    </div>
                    <button class="btn btn-primary" id="btn-generate">Generate</button>
                    
                    <div class="my-3">PC <input class="form-control" id="meeting-url"></div>
                    <div class="my-3">Mobile <input class="form-control" id="meeting-url-mobile"></div>
                    <div class="my-3">Redirect <input class="form-control" id="meeting-url-redirect"></div>
                    <small class="form-text text-muted">You may save this URL to your Notes app, calendar app or a Word document. Click it and you'll join the meeting.</small>
                    <small class="form-text text-muted">Redirect URL will automatically jump you to Zoom Mobile URL or Zoom PC URL. By using redirect URL, you will need to select your device type upon first visit. You may reset this config at any time by clicking "Clear LocalStorage"</small>
                    <div class="my-3">PC <a id="meeting-url-a"></a></div>
                    <div class="my-3">Mobile <a id="meeting-url-a-mobile"></a></div>
                    <div class="my-3">Redirect <a id="meeting-url-a-redirect"></a></div>

                    <button class="btn btn-primary" id="btn-clear">Clear LocalStorage</button>
                    <small class="form-text text-info" id="text-info"></small>
                    <!--<small class="form-text text-muted">If you're using this web page as URL redirector in sjtu-class-table-generator, and you select wrong device when being prompted, you may click this button to clear information.</small>-->

                    <h1 class="mt-3">Known Issues</h1>
                    <p class="mb-3">Firefox might not pass encoded URL correctly to ZOOM. Please use other browsers to open these URL.</p>
                    
                </div>
            </div>
        </div>
        
        <script src="script/zoom.js"></script>
        
        <script>
           
            $(document).ready(() => {
                $("#meeting-id").val("956-4485-9450")
                $("#meeting-password").val("YStURDRPbEprUE5RaFpvTFhMRDFBZz09  ")
                
                $("#meeting-name").val("Who you is")
                $("#btn-clear").click(() => {
                    localStorage.clear()
                    $("#text-info").text("information reset succeed")
                })
                $("#btn-generate").click(() => {
                    const id = $("#meeting-id").val().replace(/\D/g,'')
                    const pwd = $("#meeting-password").val().replace(/\D/g,'')
                    const pc = $("#meeting-passcode").val().replace(/\D/g,'')
                    const name = $("#meeting-name").val().trim()
                    const result = `zoommtg://zoom.us/join?confno=${id}&pwd=${pwd}&uname=${encodeURIComponent(name)}`
                    $("#meeting-url").val(result)
                    $("#meeting-url-a").attr("href", result)
                    $("#meeting-url-a").text(result)
                    const result_mobile = `zoomus://zoom.us/join?confno=${id}&pwd=${pwd}&pc=${pc}&uname=${encodeURIComponent(name)}`
                    $("#meeting-url-mobile").val(result_mobile)
                    $("#meeting-url-a-mobile").attr("href", result_mobile)
                    $("#meeting-url-a-mobile").text(result_mobile)
                    const redirect_url = `${BASE}/?jump=true&confno=${id}&pwd=${pwd}&uname=${encodeURIComponent(name)}`
                    $("#meeting-url-redirect").val(redirect_url)
                    $("#meeting-url-a-redirect").attr("href", redirect_url)
                    $("#meeting-url-a-redirect").text(redirect_url)              
                })
            })
        </script>
    </body>
</html>
